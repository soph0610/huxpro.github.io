---
layout: post
title:  "DB #1 : Transaction"
date:   2018-11-22 15:52:00
header-img: 'img/posts/03.jpg'
author:     "Soph"
catalog: true
tags:
   - DB
---

## 트랜잭션

- 트랜잭션이란?
1. 데이터베이스와 JAVA 언어가 데이터를 주고 받는 과정에 원자성을 부여하는 수단
2. 2개 이상의 쿼리를 하나의 커넥션으로 묶어 데이터베이스에 전송하고, 이 과정에서 어떠한 에러가 발생할 경우 자동으로 모든 과정을 원래 상태로 복구한다.
-> 같은 맥락이지만 로직을 어플리케이션이 아니라 데이터베이스에서 처리하는 것을 프로시저라고 한다.
-> 하나 이상의 쿼리에서 동일한 Connection 객체를 사용하는 것이다.

| 성질 | 설명 |
|--------|--------|
| 원자성 | 모든 연산이 정상적으로 처리되었거나, 아니면 전혀 수행되지 않은 상태를 보장할 것 (All or Nothing) |
| 일관성 | 데이터베이스의 일관성을 유지할 것 (제약조건이나, 인덱스 같은 ...) |
| 독립성 | 여러 트랜잭션이 수행되더라도 각각의 트랜잭션은 다른 것에 영향을 주고받지 않을 것 |
| 지속성 | 커밋이 완료되면 어떤 장애에도 커밋 결과가 보존될 것 |


- 트랜잭션 장애 발생 시 3단계 복구 [[참고]](https://d2.naver.com/helloworld/407507)

1) 로그분석단계
: 마지막 체크포인트 시점부터 최근 로그까지 로그를 탐색한다. 로그를 탐색하면서 어디서부터 시스템이 복구를 시작해야 하는지, 어느 트랜잭션들을 복구해야 하는지 등등을 알아낸다.

2) REDO 복구 단계
: 복구를 시작해야 하는 시점부터 장애 발생 직전 시점까지 REDO 복구를 실행한다.
-> 이 시점에서 데이터베이스는 장애 발생 시점의 상태와 같게 됨. 이전 상태를 재현하는 것.

3) UNDO 복구 단계
: 로그를 최신 시점부터 다시 역방향으로 탐색하면서 UNDO 복구가 필요한 로그들에 대해 UNDO 복구를 실행한다. 2단계를 통해 데이터베이스를 장애 시점까지 복원해두고, UNDO 복구를 진행하면서 여러 트랜잭션을 철회해 장애를 복구한다. (Global UNDO)


  
